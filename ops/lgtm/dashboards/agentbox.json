{
  "uid": "agentbox-overview",
  "title": "AgentBox Overview",
  "timezone": "browser",
  "editable": true,
  "refresh": "30s",
  "time": { "from": "now-1h", "to": "now" },
  "panels": [
    {
      "type": "row",
      "title": "Logs",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "collapsed": false
    },
    {
      "type": "logs",
      "title": "Backend Logs",
      "datasource": { "type": "loki", "uid": "loki" },
      "targets": [
        {
          "expr": "{compose_service=\"backend\"}",
          "refId": "A"
        }
      ],
      "options": {
        "showTime": true,
        "showLabels": false,
        "showCommonLabels": false,
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none"
      },
      "gridPos": { "h": 10, "w": 24, "x": 0, "y": 1 }
    },
    {
      "type": "row",
      "title": "Instances",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 11 },
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Active Instances",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances{status=\"running\"}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 20 },
              { "color": "red", "value": 40 }
            ]
          }
        }
      },
      "gridPos": { "h": 6, "w": 4, "x": 0, "y": 12 }
    },
    {
      "type": "bargauge",
      "title": "Instances by Status",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ],
      "options": {
        "orientation": "horizontal",
        "displayMode": "gradient",
        "showUnfilled": true,
        "minVizWidth": 0,
        "minVizHeight": 10
      },
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "steps": [{ "color": "green", "value": null }]
          }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "running" },
            "properties": [{ "id": "color", "value": { "fixedColor": "green", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "provisioning" },
            "properties": [{ "id": "color", "value": { "fixedColor": "blue", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "minting" },
            "properties": [{ "id": "color", "value": { "fixedColor": "purple", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "stopped" },
            "properties": [{ "id": "color", "value": { "fixedColor": "orange", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "error" },
            "properties": [{ "id": "color", "value": { "fixedColor": "red", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "deleting" },
            "properties": [{ "id": "color", "value": { "fixedColor": "yellow", "mode": "fixed" } }]
          },
          {
            "matcher": { "id": "byName", "options": "deleted" },
            "properties": [{ "id": "color", "value": { "fixedColor": "text", "mode": "fixed" } }]
          }
        ]
      },
      "gridPos": { "h": 6, "w": 10, "x": 4, "y": 12 }
    },
    {
      "type": "stat",
      "title": "Total Created",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances_total",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" } } },
      "gridPos": { "h": 6, "w": 5, "x": 14, "y": 12 }
    },
    {
      "type": "stat",
      "title": "Total Minted",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances_minted",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": { "color": { "fixedColor": "purple", "mode": "fixed" } } },
      "gridPos": { "h": 6, "w": 5, "x": 19, "y": 12 }
    },
    {
      "type": "row",
      "title": "Business",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 18 },
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Total Revenue",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances_total * 5",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": { "unit": "currencyUSD", "color": { "fixedColor": "green", "mode": "fixed" } }
      },
      "gridPos": { "h": 5, "w": 4, "x": 0, "y": 19 }
    },
    {
      "type": "stat",
      "title": "Unique Owners",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_unique_owners",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" } } },
      "gridPos": { "h": 5, "w": 4, "x": 4, "y": 19 }
    },
    {
      "type": "stat",
      "title": "Created (7d)",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances_created_7d",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": { "color": { "fixedColor": "blue", "mode": "fixed" } } },
      "gridPos": { "h": 5, "w": 4, "x": 8, "y": 19 }
    },
    {
      "type": "stat",
      "title": "Expiring (24h)",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances_expiring_24h",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 3 },
              { "color": "red", "value": 10 }
            ]
          }
        }
      },
      "gridPos": { "h": 5, "w": 4, "x": 12, "y": 19 }
    },
    {
      "type": "stat",
      "title": "Minting Success %",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_instances_minted / agentbox_instances_total * 100",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 0,
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 80 },
              { "color": "green", "value": 95 }
            ]
          }
        }
      },
      "gridPos": { "h": 5, "w": 4, "x": 16, "y": 19 }
    },
    {
      "type": "stat",
      "title": "Provisioning Avg",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_provisioning_avg_seconds",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "s",
          "decimals": 0,
          "thresholds": {
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 300 },
              { "color": "red", "value": 600 }
            ]
          }
        }
      },
      "gridPos": { "h": 5, "w": 4, "x": 20, "y": 19 }
    },
    {
      "type": "table",
      "title": "Recent Instance Creations",
      "datasource": { "type": "postgres", "uid": "postgres" },
      "targets": [
        {
          "rawSql": "SELECT uuid_extract_timestamp(e.id) AS \"Created\", e.metadata->>'ownerWallet' AS \"Owner Wallet\", e.metadata->>'name' AS \"Instance\" FROM events e WHERE e.event_type = 'instance.created' ORDER BY e.id DESC LIMIT 20",
          "refId": "A",
          "format": "table"
        }
      ],
      "fieldConfig": {
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "Created" },
            "properties": [{ "id": "unit", "value": "dateTimeAsIso" }]
          },
          {
            "matcher": { "id": "byName", "options": "Owner Wallet" },
            "properties": [{ "id": "custom.width", "value": 400 }]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 24 }
    },
    {
      "type": "row",
      "title": "On-chain Wallets",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 32 },
      "collapsed": false
    },
    {
      "type": "stat",
      "title": "Hot Wallet SOL",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_wallet_sol_lamports{wallet=\"hot\"} / 1e9",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 4,
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 0.1 },
              { "color": "green", "value": 1 }
            ]
          }
        }
      },
      "options": { "postfix": " SOL" },
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 33 }
    },
    {
      "type": "stat",
      "title": "Hot Wallet USDC",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_wallet_usdc_micro{wallet=\"hot\"} / 1e6",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 2,
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 10 },
              { "color": "green", "value": 50 }
            ]
          }
        }
      },
      "options": { "postfix": " USDC" },
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 33 }
    },
    {
      "type": "stat",
      "title": "Treasury SOL",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_wallet_sol_lamports{wallet=\"treasury\"} / 1e9",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 4,
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 0.1 },
              { "color": "green", "value": 1 }
            ]
          }
        }
      },
      "options": { "postfix": " SOL" },
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 33 }
    },
    {
      "type": "stat",
      "title": "Treasury USDC",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "agentbox_wallet_usdc_micro{wallet=\"treasury\"} / 1e6",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "decimals": 2,
          "thresholds": {
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 10 },
              { "color": "green", "value": 100 }
            ]
          }
        }
      },
      "options": { "postfix": " USDC" },
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 33 }
    },
    {
      "type": "row",
      "title": "HTTP",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 37 },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Request Rate by Status",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(rate(agentbox_http_request_duration_seconds_count[5m])) by (status)",
          "legendFormat": "{{status}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "reqps"
        }
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 38 }
    },
    {
      "type": "timeseries",
      "title": "Latency (p50 / p95 / p99)",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum(rate(agentbox_http_request_duration_seconds_bucket[5m])) by (le))",
          "legendFormat": "p50",
          "refId": "A"
        },
        {
          "expr": "histogram_quantile(0.95, sum(rate(agentbox_http_request_duration_seconds_bucket[5m])) by (le))",
          "legendFormat": "p95",
          "refId": "B"
        },
        {
          "expr": "histogram_quantile(0.99, sum(rate(agentbox_http_request_duration_seconds_bucket[5m])) by (le))",
          "legendFormat": "p99",
          "refId": "C"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "s"
        }
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 38 }
    },
    {
      "type": "timeseries",
      "title": "Error Rate (4xx + 5xx)",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "sum(rate(agentbox_http_request_duration_seconds_count{status=~\"4..|5..\"}[5m]))",
          "legendFormat": "errors/s",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "fillOpacity": 20, "lineWidth": 2 },
          "unit": "reqps",
          "color": { "fixedColor": "red", "mode": "fixed" }
        }
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 38 }
    },
    {
      "type": "row",
      "title": "System (Node.js)",
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 46 },
      "collapsed": false
    },
    {
      "type": "timeseries",
      "title": "Heap Memory",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "process_heap_bytes{job=\"backend\"}",
          "legendFormat": "heap used",
          "refId": "A"
        },
        {
          "expr": "process_resident_memory_bytes{job=\"backend\"}",
          "legendFormat": "RSS",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "bytes"
        }
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 47 }
    },
    {
      "type": "timeseries",
      "title": "Event Loop Lag",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "nodejs_eventloop_lag_seconds{job=\"backend\"}",
          "legendFormat": "lag",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "s"
        }
      },
      "gridPos": { "h": 8, "w": 8, "x": 8, "y": 47 }
    },
    {
      "type": "timeseries",
      "title": "CPU Usage",
      "datasource": { "type": "prometheus", "uid": "prometheus" },
      "targets": [
        {
          "expr": "rate(process_cpu_seconds_total{job=\"backend\"}[5m])",
          "legendFormat": "CPU cores",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "custom": { "drawStyle": "line", "fillOpacity": 10, "lineWidth": 2 },
          "unit": "short"
        }
      },
      "gridPos": { "h": 8, "w": 8, "x": 16, "y": 47 }
    }
  ],
  "schemaVersion": 39,
  "templating": { "list": [] },
  "annotations": { "list": [] }
}
